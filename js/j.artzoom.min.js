/* ArtZoom v0.1 - A light-weight, customizable image zoom plugin for jQuery with colorbox integration
 *
 * Copyright (c) 2011 Sergio Toro - sergio@art4websites.com
 * Pluguin url: http://blog.art4websites.com/artzoom-simple-image-zoom-para-jquery
 *
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */
(function(a){a.fn.artzoom=function(b){var c={top:0,left:"auto",width:"auto",height:"auto",distance:25,zIndex:100,enableGallery:true,galleryMargin:5,gallerySpeed:250,prevText:"«",nextText:"»",colorboxIntegration:true,colorboxLabel:"click on image to enlarge",colorboxOptions:{maxWidth:"80%",maxHeight:"95%",rel:"az-gallery"}};return this.each(function(){function X(a){if(!a.complete||typeof a.naturalWidth!="undefined"&&a.naturalWidth==0)return true;return false}function W(){if(a.type(a.colorbox)!=="function"){v=false;return}u=a('<a href="javascript:;" class="az-colorbox-trigger"><span class="az-colorbox-text">'+(c.colorboxLabel?c.colorboxLabel:"&nbsp")+"</span></a>");d.append(u);j.colorbox(c.colorboxOptions);v=true;u.click(function(){var b={href:f.attr("href")};a.extend(true,b,c.colorboxOptions);a.colorbox(b)}).mouseover(function(){clearTimeout(w);u.show()}).mouseout(function(){w=setTimeout(function(){u.hide()},50)})}function V(){var b=false;a.each(k,function(){if(X(this))b=true});if(!A||b){setTimeout(V,200);return}p=k.width();q=k.height();var d=a("div.az-gal-container",n);var e={width:A+"px",height:q+"px"};d.css(e);n.css(e);l.css({width:p*j.length+(j.length-1)*c.galleryMargin+"px",height:q+"px"});r=p+c.galleryMargin;t=Math.floor(A/p)}function U(){if(!A){setTimeout(U,200);return}a.each(j,function(){var b=a(this);var c=b.data();b.append(a('<img src="'+c.smallThumb+'" alt="'+(c.alt?c.alt:"")+'" title="'+(c.title?c.title:"")+'" />'))});n=a('<div class="az-gal-relative"/>');m=a('<a href="javascript:;" class="az-gal-control az-gal-prev" data-type="previous">'+c.prevText+'</a><a href="javascript:;" class="az-gal-control az-gal-next" data-type="next">'+c.nextText+"</a>");k=a("img",j);j.addClass("az-gallery az-gal-trig").wrap(a('<li class="az-gal-item"></li>')).parent().wrapAll(a('<div class="az-gal-container"><ul class="az-gal-carrusel"></ul></div>"')).parent().parent().appendTo(n);l=a("ul.az-gal-carrusel",n);n.append(m);a("li.az-gal-item:not(:last)",l).css("margin-right",c.galleryMargin+"px");d.append(n);V();j.click(function(b){b.preventDefault();b.stopPropagation();var c=a(this);var d=c.data();if(d.bigThumb==h.attr("src"))return;h=null;A=false;O();h=a("img",f).attr("src",d.bigThumb);f.attr("href",c.attr("href"));h.attr("title",d.title?d.title:"");N.css("background","#FFF").addClass("az-loading");L=false;M=false;V()});m.click(function(){var b=a(this);var d=b.data();var e=false;m.removeClass("az-disabled");switch(d.type){case"previous":e=0;if(o-t>0)e=o-t;else b.addClass("az-disabled");break;case"next":e=j.length-t;if(o+t<j.length-t)e=o+t;else b.addClass("az-disabled");break}if(e===false)return;o=e;l.animate({left:o*r*-1+"px"},c.gallerySpeed)})}function T(){if(!K||!M)return;var a=H-E.left;var b=I-E.top;var c=Math.round(a*F);var d=Math.round(b*G);c=c>C?C:c;d=d>D?D:d;N.css({"background-position":-c+"px "+ -d+"px"})}function S(){if(!M)return;clearInterval(J);N.hide();K=false}function R(){if(!i||X(i[0])){setTimeout(R,200);return}N.css("background",'url("'+f.attr("href")+'") no-repeat 50% 50%').removeClass("az-loading");C=i[0].naturalWidth-y;D=i[0].naturalHeight-z;F=C/A;G=D/B;M=true;T()}function Q(){i=null;R();x=new Image;x.src=f.attr("href");i=a(x);L=true}function P(){K=true;N.show();J=setInterval(T,30);if(L)return;Q()}function O(){if(!h||X(h[0])){setTimeout(O,200);return}A=h.width();B=h.height();E=h.offset();d.width(A);y=c.width=="auto"?A:parseInt(c.width);z=c.height=="auto"?B:parseInt(c.height);N.css({width:y+"px",height:z+"px",top:parseInt(c.top)+"px",left:(c.left=="auto"?A+parseInt(c.distance):parseInt(c.left))+"px"})}if(b)a.extend(true,c,b);var d=a(this);var e=c.enableGallery;var f=a("> a",d);if(f.length==1)e=false;else if(f.length>1)f=a(f[0]);if(e)f.after(f.clone());f.addClass("az-main");var g=f.data();var h=a(a('<img src="'+g.bigThumb+'" alt="'+(g.alt?g.alt:"")+'" title="'+(g.title?g.title:"")+'" />'));var i;var j=a("> a",d).not(".az-main");var k;var l;var m;var n;var o=0;var p;var q;var r;var t;var u;var v=false;var w;var x;var y;var z;var A;var B;var C;var D;var E;var F;var G;var H;var I;var J;var K=false;var L=false;var M=false;var N=a('<div class="az-zoom az-loading"/>');d.addClass("az-container").css("zIndex",parseInt(c.zIndex)).append(N);f.append(h).addClass("az-cursor").click(function(a){a.preventDefault()}).mouseover(function(a){P();if(c.colorboxIntegration&&v){clearTimeout(w);w=setTimeout(function(){u.show()},250)}}).mouseout(function(){S();if(c.colorboxIntegration&&v){clearTimeout(w);w=setTimeout(function(){u.hide()},150)}}).mousemove(function(a){H=a.pageX;I=a.pageY});if(c.colorboxIntegration)W();if(j.length&&e)U();O();h.error(function(){a.error("ArtZoom: Unable to load the image, check the route.")})})}})(jQuery)