/* ArtZoom v0.1 - A light-weight, customizable image zoom plugin for jQuery with colorbox integration
 *
 * Copyright (c) 2011 Sergio Toro - sergio@art4websites.com
 * Pluguin url: http://blog.art4websites.com/artzoom-simple-image-zoom-para-jquery
 *
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */
(function(a){a.fn.artzoom=function(b){var c={top:0,left:"auto",width:"auto",height:"auto",distance:25,zIndex:100,update:35,enableGallery:true,galleryMargin:5,gallerySpeed:250,showControls:true,prevText:"«",nextText:"»",colorboxIntegration:true,colorboxLabel:"click on image to enlarge",colorboxOptions:{maxWidth:"80%",maxHeight:"95%",rel:"az-gallery"}};return this.each(function(){function X(a){if(!a.complete||a.width==0||typeof a.naturalWidth!="undefined"&&a.naturalWidth==0)return true;return false}function W(){if(a.type(a.colorbox)!=="function"){w=false;return}v=a('<a href="javascript:;" class="az-colorbox-trigger"><span class="az-colorbox-text">'+(c.colorboxLabel?c.colorboxLabel:"&nbsp")+"</span></a>");d.append(v);k.colorbox(c.colorboxOptions);w=true;v.click(function(){var b={href:f.attr("href")};a.extend(true,b,c.colorboxOptions);a.colorbox(b)}).mouseover(function(){clearTimeout(x);v.show()}).mouseout(function(){x=setTimeout(function(){v.hide()},50)})}function V(){var b=false;a.each(l,function(){if(X(this))b=true});if(!B||b){setTimeout(V,200);return}q=l.width();r=l.height();var d=a("div.az-gal-container",o);var e={width:B+"px",height:r+"px"};d.css(e);o.css(e);m.css({width:q*k.length+(k.length-1)*c.galleryMargin+"px",height:r+"px"});t=q+c.galleryMargin;u=Math.floor(B/q);if(c.showControls){if(k.length<=u)m.css("left","0px");else n.show()}}function U(){if(!B){setTimeout(U,200);return}a.each(k,function(){var b=a(this);var c=b.data();b.append(a('<img src="'+c.smallThumb+'" title="'+(c.title?c.title:"")+'" />'))});o=a('<div class="az-gal-relative"/>');n=a('<a href="javascript:;" class="az-gal-control az-disabled az-gal-prev" data-type="previous">'+(c.prevText?c.prevText:"&nbsp")+'</a><a href="javascript:;" class="az-gal-control az-gal-next" data-type="next">'+(c.nextText?c.nextText:" ")+"</a>");l=a("img",k);k.addClass("az-gallery az-gal-trig").wrap(a('<li class="az-gal-item"></li>')).parent().wrapAll(a('<div class="az-gal-container"><ul class="az-gal-carrusel"></ul></div>"')).parent().parent().appendTo(o);m=a("ul.az-gal-carrusel",o);o.append(n);a("li.az-gal-item:not(:last)",m).css("margin-right",c.galleryMargin+"px");d.append(o);V();k.click(function(b){b.preventDefault();b.stopPropagation();var d=a(this);var e=d.data();if(e.bigThumb==j.attr("src"))return;if(c.showControls)n.hide();j=null;B=false;i=new Image;i.src=e.bigThumb;h=e.title?e.title:"";f.attr("href",d.attr("href"));N.css("background","#FFF").addClass("az-loading");L=false;M=false;O();V()});n.click(function(){var b=a(this);var d=b.data();var e=false;n.removeClass("az-disabled");switch(d.type){case"previous":e=0;if(p-u>0)e=p-u;else b.addClass("az-disabled");break;case"next":e=k.length-u;if(p+u<k.length-u)e=p+u;else b.addClass("az-disabled");break}if(e===false)return;p=e;m.animate({left:p*t*-1+"px"},c.gallerySpeed)})}function T(){if(!K||!M)return;var a=j.offset();var b=H-a.left;var c=I-a.top;var d=b*F;var e=c*G;d=d>D?D:d;e=e>E?E:e;N.css({"background-position":-d+"px "+ -e+"px"})}function S(){if(!M)return;clearInterval(J);N.hide();K=false}function R(){if(!y||X(y)){setTimeout(R,200);return}N.css("background",'url("'+y.src+'") no-repeat 50% 50%').removeClass("az-loading");D=y.width-z;E=y.height-A;F=D/B;G=E/C;M=true;T()}function Q(){y=new Image;y.src=f.attr("href");R();L=true}function P(){K=true;N.show();J=setInterval(T,c.update);if(L)return;Q()}function O(){if(!i||X(i)){setTimeout(O,200);return}j=a(i);j.attr("title",h);f.html("").append(j);B=j.width();C=j.height();d.width(B);f.width(B).height(C);z=c.width=="auto"?B:parseInt(c.width);A=c.height=="auto"?C:parseInt(c.height);N.css({width:z+"px",height:A+"px",top:parseInt(c.top)+"px",left:(c.left=="auto"?B+parseInt(c.distance):parseInt(c.left))+"px"})}if(b)a.extend(true,c,b);var d=a(this),e=c.enableGallery,f=a("> a",d);if(f.length==1)e=false;else if(f.length>1)f=a(f[0]);if(e)f.after(f.clone());f.addClass("az-main");var g=f.data(),h,i,j;var k=a("> a",d).not(".az-main"),l,m,n,o,p=0,q,r,t,u;var v,w=false,x;var y,z,A,B,C,D,E,F,G,H,I;var J,K=false,L=false,M=false,N=a('<div class="az-zoom az-loading"/>');d.addClass("az-container").css("zIndex",parseInt(c.zIndex)).append(N);f.addClass("az-cursor").click(function(a){a.preventDefault()}).mouseover(function(a){P();if(c.colorboxIntegration&&w){clearTimeout(x);x=setTimeout(function(){v.show()},250)}}).mouseout(function(){S();if(c.colorboxIntegration&&w){clearTimeout(x);x=setTimeout(function(){v.hide()},150)}}).mousemove(function(a){H=a.pageX;I=a.pageY});if(c.colorboxIntegration)W();if(k.length&&e)U();i=new Image;i.src=g.bigThumb;h=g.title?g.title:"";O()})}})(jQuery)